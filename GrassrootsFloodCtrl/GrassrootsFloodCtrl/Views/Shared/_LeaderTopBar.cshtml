@using GrassrootsFloodCtrl.Model.Enums;

<link href="~/css/top.css" rel="stylesheet" />
<link href="~/Content/bootstrap.min.css" rel="stylesheet" />
<script src="~/scripts/bootstrap.min.js"></script>
<script src="~/js/main.js"></script>
    <link rel="stylesheet" href="~/Content/modifycss/AddHeader.css" />
    <link rel="stylesheet" href="~/Content/modifycss/index.css" />
    <header id="in-header">
        @if (ViewBag.RoleId == (int)GrassrootsFloodCtrlEnums.RoleEnums.乡镇用户)
        {
           @(Html.Raw(" <div class=\"in-header-left\" style=\"min-width: 0px;width: 45%;\">")) <div><a href=""></a></div>
        }
        else
        {
            @(Html.Raw(" <div class=\"in-header-left\" style=\"min-width: 0px;width: 45%;\">"))
            <div style="background:url(../../Content/modifyimg/logo-sjcj1.png) no-repeat left center;"><a href=""></a></div>
        }

        <div class="layer_control_year container">
            <div class="header-btn" style="font-size: 15px;display:none;margin-left:10px;">
                <span></span>
                <div></div>
            </div>
            <ul id="in-header-select" class="header-submenu "></ul>
        </div>
    </div>
        @if (ViewBag.RoleId == (int)GrassrootsFloodCtrlEnums.RoleEnums.市级用户)
        {
            @(Html.Raw("<div class=\"in-header-right\" style=\"width:66%\">"))
            <a href="/ComprehensiveApp">
                <div class="in-header-right-0">
                    <span></span>
                    <span style="color:none;">
                        综合查询
                    </span>
                </div>
            </a>
            <a href="/TaskArragement/Emergency" style="margin:0 15px;">
                <div class="in-header-right-22">
                    <span></span>
                    <span>
                        应急管理
                    </span>
                </div>
            </a>
            <a href="/StatisAnalysis" >
                <div class="in-header-right-1">
                    <span></span>
                    <span>
                        统计分析
                    </span>
                </div>
            </a>
            <a href="/Audit/CityIndex">
                <div class="in-header-right-33">
                    <span></span>
                    <span>
                        组织责任
                    </span>
                </div>
            </a>
           
        }
        else if (ViewBag.RoleId == (int)GrassrootsFloodCtrlEnums.RoleEnums.县级用户)
        { @(Html.Raw("<div class=\"in-header-right\" style=\"width:66%\">"))
            <a href="/ComprehensiveApp">
                <div class="in-header-right-0">
                    <span></span>
                    <span style="color:none;">
                        综合查询
                    </span>
                </div>
            </a>
            <a href="/TaskArragement/Emergency">
                <div class="in-header-right-22">
                    <span></span>
                    <span>
                        应急管理
                    </span>
                </div>
            </a>
             <a href="/StatisAnalysis/StatisType">
                <div class="in-header-right-1">
                    <span></span>
                    <span>
                        统计分析
                    </span>
                </div>
            </a>
            <a href="/Audit/CountyIndex">
                <div class="in-header-right-33">
                    <span></span>
                    <span>
                        组织责任
                    </span>
                </div>
            </a>          
        }
        else if (ViewBag.RoleId == (int)GrassrootsFloodCtrlEnums.RoleEnums.省级用户)
        { @(Html.Raw("<div class=\"in-header-right\" style=\"width:55%\">"))
            <a href="/Leader/Index">
                <div class="in-header-right-8">
                    <span></span>
                    <span style="color:none;">
                        首页
                    </span>
                </div>
            </a>
            <a href="/ComprehensiveApp/LeaderIndex">
                <div class="in-header-right-0">
                    <span></span>
                    <span>
                        综合查询
                    </span>
                </div>
            </a>
            <a href="/StatisAnalysis/LeaderIndex">
                <div class="in-header-right-1">
                    <span></span>
                    <span>
                        统计分析
                    </span>
                </div>
            </a>
            <a href="/TaskArragement/LeaderEmergency">
                <div class="in-header-right-22">
                    <span></span>
                    <span>
                        应急管理
                    </span>
                </div>
            </a>
        }
        else
        //乡镇用户的组织责任
        {@(Html.Raw("<div class=\"in-header-right\" style=\"width:52%\">"))
            <a href="/Home">
                <div class="in-header-right-33">
                    <span></span>
                    <span>
                        组织责任
                    </span>
                </div>
            </a>
        }
        @if (ViewBag.RoleId != (int)GrassrootsFloodCtrlEnums.RoleEnums.省级用户)
        {
        <a href="javascript:void(0);">
            <div class="in-header-right-2">
                <span></span>
                <span>应急预案</span>
            </div>
        </a>
        <a href="javascript:void(0);">
            <div class="in-header-right-3">
                <span></span>
                <span>监测预警</span>
            </div>
        </a>
        <a href="javascript:void(0);">
            <div class="in-header-right-4">
                <span></span>
                <span>安全避险</span>
            </div>
        </a>
        <a href="javascript:void(0);">
            <div class="in-header-right-5">
                <span></span>
                <span>应急救援</span>
            </div>
        </a>
        }
        else if (ViewBag.RoleId == (int)GrassrootsFloodCtrlEnums.RoleEnums.省级用户)
        {
            <a href="/Supervise/LeaderIndex">
                <div class="in-header-right-6">
                    <span></span>
                    <span>监督考核</span>
                </div>
            </a>
        }
        else
        {

        }
    </div>
    <div id="in-header-config-box" style="width:200px">
            <img style="height:45px;" class="bor rd" src="@ViewData["headpicture"]" />
            <a>@ViewData["leaderName"]</a>
            <a>【@ViewData["orgname"]】</a>
    </div>
</header>
<!-- -->
<script>
    var hovertime = 0;
    var curYear = (new Date()).getFullYear(); //当前年份
    var globalYear = curYear; //全局的年份
    var yearCookie = $.cookie('year');

    if (yearCookie != null)
        globalYear = yearCookie;
    var html = globalYear + '年度';
    /* 获取当前页 为设置菜单选择使用 开始 */
    var _url = $(".mm").context.URL.replace("http://", "");
    var _index = _url.indexOf("/");
    var _home = "";
    var roleId=@ViewBag.RoleId;
    var cityId=@GrassrootsFloodCtrlEnums.RoleEnums.市级用户.GetId();
    var countyId=@GrassrootsFloodCtrlEnums.RoleEnums.县级用户.GetId();
    var provinceId=@GrassrootsFloodCtrlEnums.RoleEnums.省级用户.GetId();

    if (@ViewBag.RoleId == cityId)
        _home="/Audit/CityIndex";
    else if (@ViewBag.RoleId == countyId)
         _home = "/Audit/CountyIndex";
    else
        _home = "/Home";

    //var _route = _url.substring(_index) == "/" ? _home: _url.substring(_index);
    var path=window.location.pathname;
    var _route= path == "/"? _home : path;
    /* 获取当前页 为设置菜单选择使用 结束 */
    $(function () {
        //清楚cookie
        clearCookie();
        //重新设置cookie
        $.cookie('year', globalYear, { path: '/' });
        //初始化年度
        $(".header-btn span").html(html);
        //初始化年度，默认5年（明年，今年， 去年...）
        var strLi = "";
        for (var i = 0; i < 10; i++) {
            var value = curYear + i;
            if (value <= globalYear) {
                strLi += '<li onclick="setYear(' + value + ')">' + value + '年度</li>';
            }
        }
        //$(".dropdown-menu").html(strLi);
        $("#in-header-select").html(strLi);
        //
        $(".header-btn").click(function () {
            $("#in-header-select").addClass("on");
        });
        $(".header-submenu li").click(function() {
            var tex = $(this).text();
            $(".header-btn span").text(tex);
            $("#in-header-select").removeClass("on");
        });

        /* 设置菜单选中样式 以及点击样式  开始*/
        switch(_route){
            case "/Town":_route = "/Home"; break;
            case "/Village":_route = "/Home"; break;
            case "/Village/VillageGridPersonLiabel":_route = "/Home";break;
            case "/Village/VillageTransferPerson":_route = "/Home";break;
            case "/Village/VillagePic":_route = "/Home";break;
            case "/CountryPerson":_route = "/Audit/CountyIndex";break;
            case "/Audit/TownInfo/":_route =_home;break;
            case "/Audit/TownInfo":_route = _home;break;
            case "/Audit/CityCountyIndex":_route=_home;break;
            case "/Audit/CountyPerson/":_route=_home;break;
            case "/ComprehensiveApp":_route='/ComprehensiveApp';break;
            case "/StatisAnalysis": _route = '/StatisAnalysis'; break;
            case "/TaskArragement": _route = '/StatisAnalysis'; break;
            case "/Leader":_route = '/Leader'; break;
        }
        if(roleId == cityId && (_route.indexOf("/Supervise") != -1 || _route.indexOf("/Log") != -1)){ _route = "/Supervise/County"; }
        if(roleId == countyId && _route.indexOf("/Supervise") != -1 || _route.indexOf("/Log") != -1){_route ="/Supervise/Towns";}
        if(roleId == provinceId && _route.indexOf("/Supervise") != -1 || _route.indexOf("/Log") != -1){_route ="/Supervise/LeaderIndex";}
        if(_route.indexOf("/StatisAnalysis") != -1){ _route = "/StatisAnalysis/LeaderIndex"; }

        if(roleId == countyId && _route.indexOf("/StatisAnalysis") != -1){ _route = "/StatisAnalysis/StatisType"; }
        //if (_route == "/Town" || _route == "/Village" || _route == "/Village/VillageGridPersonLiabel"
        //    || _route == "/Village/VillageTransferPerson" || _route == "/Village/VillagePic"
        //    || _route == "/CountryPerson"  || _route == "/Audit/TownInfo")
        //    _route = "/Home";
        //else if(_route=="/CountryPerson")
        //    _route = "/Audit/CountyIndex";
        $(".in-header-right a div").removeClass("header-select");
        $(".in-header-right a[href='" + _route + "'] div").addClass("header-select");

        $(".in-header-right a").click(function () {
            var url = $(this).attr("href");
            if (url!="javascript:void(0);"){
                $(".in-header-right a div").removeClass("header-select");
                $(this).find("div").addClass("header-select");
            }
        });
        /* 设置菜单选中样式 以及点击样式  结束*/
    });
        //选择后设置年度，并刷新数据
        function setYear(value) {
            globalYear = value;
            // html = value + '年度 <span class="caret"></span>';
            // $("button[data-toggle='dropdown']").html();
            // $("button[data-toggle='dropdown']").html(html);

            clearCookie();
            $.cookie('year', value, { path: '/' });

            location.reload();
        }

        $(".glyphicon-cog,.topbar .setting-ul").hover(function() {
            clearTimeout(hovertime);
            $(".topbar .setting-ul").show();
            $(".setting").css("background", "#1c77d2");
        }, function() {
            clearTimeout(hovertime);
            hovertime = setTimeout(function() {
                $(".topbar .setting-ul").hide();
                $(".setting").css("background", "transparent");
            }, 200);
        });

        //修改密码
        function editPassword() {
            openModal('修改密码', '/Home/EditPassword', { width: 600 });
        }
        //清楚cookie
        function clearCookie() {

            if ($.cookie('year') != null) {
                $.cookie('year', '', { expires: -1 });
            }
        }

</script>

