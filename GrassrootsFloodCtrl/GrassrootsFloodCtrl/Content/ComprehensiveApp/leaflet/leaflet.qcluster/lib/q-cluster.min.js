var QCluster=function(a){var b;return b=function(a,b,c,d,e,f){var g,h,i,j,k,l;for(g=f,h=!1,i=b+c,j=a.length;!h;)i>=j||0>i?h=!0:(a[i].c||(k=Math.abs(a[i].x-a[b].x)/e,l=Math.abs(a[i].y-a[b].y)/e,g>k?g>l&&(d.points.push(a[i]),d.c=!0,a[i].c=!0):h=!0),i+=c)},a.clusterPoints=function(a,c,d,e){function f(a,b,c,d,e,f){return a>d||c>a||b>f||e>b?!1:!0}for(var g=0,h=[],i=null,j=a.length,k=j-1;k>=0;k--)a[k].c=null;for(var l=j-1;l>=0;l--)!a[l].c&&f(a[l].x,a[l].y,c.xmin,c.xmax,c.ymin,c.ymax)&&(i={id:g,points:[],xSum:0,ySum:0,cX:null,cY:null},g++,i.points.push(a[l]),b(a,l,-1,i,d,e),b(a,l,1,i,d,e),h.push(i));for(var m=0,n=h.length;n>m;m++){for(var o=h[m],p=0,q=o.points.length;q>p;p++)o.xSum=o.xSum+o.points[p].x,o.ySum=o.ySum+o.points[p].y;o.cX=o.xSum/o.points.length,o.cY=o.ySum/o.points.length,delete o.xSum,delete o.ySum}return h},a.moreThanOneCluster=function(a,c,d){for(var e,f=0,g=[],h=a.length,i=h-1;i>=0;i--)a[i].c=null;for(var j=h-1;j>=0;j--)a[j].c||(e={id:f,points:[],xSum:0,ySum:0,cX:null,cY:null},f++,e.points.push(a[j]),b(a,j,-1,e,c,d),b(a,j,1,e,c,d),g.push(e));return g.length>1?!0:!1},a}(QCluster||{}),QCluster=function(a){function b(a,b,c){var d,e,f,g,h;return h=c||0,d=L.CRS.EPSG3857.project(a._southWest).x-c*b,e=L.CRS.EPSG3857.project(a._northEast).x+c*b,f=L.CRS.EPSG3857.project(a._southWest).y-c*b,g=L.CRS.EPSG3857.project(a._northEast).y+c*b,{xmin:d,xmax:e,ymin:f,ymax:g}}function c(a,b){var c,d,b,e;return e=a.getSize().x,c=L.CRS.EPSG3857.project(b._southWest).x,d=L.CRS.EPSG3857.project(b._northEast).x,(d-c)/e}function d(a,b){return a.georef<b.georef?-1:a.georef>b.georef?1:0}function e(a,b,c){function d(a,b){var c,d,e,f,g="";c=Math.pow(10,5-b),60==a&&(a=59.999),a=1e3*a,d=Math.floor(a/c),e=d.toString().length,b>e&&(f=b-e);for(var h=0;f>h;h++)g+="0";return g+=d}var e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,A,B,C,D,E,F,G=[],H="",F="ABCDEFGHIJKLMNOPQRSTUVWXYZABCDEFGHIJKLMNOPQRSTUVWXYZ";if(n=-90,o=90,p=-180,q=360,r=60,s=4,t=14,u=4,v=5,w=8,x=12,y=14,z=16,A=25,B=78,C=48,PI=3.141592653589793,D=15,E=5e-7,n>b||b>o)return null;if(p>a)return null;if(0>c||c>v)return null;for(a>180&&(a-=360),g=p,h=n,j=(a-g)/D+E,G[0]=j>=0?Math.floor(j):Math.ceil(j),k=a-(G[0]*D+g),G[2]=k>=0?Math.floor(k):Math.ceil(k)+E,e=(k-G[2])*r,l=(b-h)/D+E,G[1]=l>=0?Math.floor(l):Math.ceil(l),m=b-(G[1]*D+h),G[3]=m>=0?Math.floor(m+E):Math.ceil(m+E),f=(m-G[3])*r,i=0;4>i;i++)G[i]>=w&&(G[i]+=1),G[i]>=y&&(G[i]+=1);for(26==G[0]&&(G[0]=A,G[2]=z,e=59.999),13==G[1]&&(G[1]=x,G[3]=z,f=59.999),i=0;4>i;i++)H+=F[G[i]];return H+=d(e,c),H+=d(f,c)}function f(a,b){var c,d;return Math.abs(b)>20037508.3427892?(console.error("Mercator X: "+b+" is > 20037508.3427892."),[null,null]):Math.abs(a)>20037508.3427892?(console.error("Mercator Y: "+a+" is > 20037508.3427892."),[null,null]):(c=b/6378137*57.29577951308232-360*Math.floor((b/6378137*57.29577951308232+180)/360),d=57.29577951308232*(1.5707963267948966-2*Math.atan(Math.exp(-1*a/6378137))),[c,d])}function g(a){var b=[];if(a.features)b=a.features;else if(a instanceof Array)for(var c=a.length-1;c>=0;--c)b=b.concat(a[c].features);else{if(!a[Object.keys(a)[0]].features)return console.err("Faulty Data. No GeoJSON found."),[];for(var f in a)a[f].features&&(b=b.concat(a[f].features))}for(var g=[],h=b.length-1;h>=0;--h){var i=b[h],j=b[h].properties,k=i.geometry.coordinates[0],l=i.geometry.coordinates[1],m=L.CRS.EPSG3857.project(L.latLng(l,k));g.push($.extend(!0,{georef:e(k,l,4),lng:k,lat:l,x:m.x,y:m.y},j))}return g.sort(d)}function h(a){var b,c,f,g,h;for(b=[],f=a.length,c=f-1;c>=0;--c)g=a[c],lng=g.lng,lat=g.lat,h=L.CRS.EPSG3857.project(L.latLng(lat,lng)),b.push($.extend(!0,{georef:e(lng,lat,4),x:h.x,y:h.y},g));return b.sort(d)}return a.PointClusterer=function(b,c,d,e,f){var i,j;return i=f||{},this.layerId=c,this.clickHandler=i.clickHandler||this.defaultClickHandler,this.mouseoverHandler=i.mouseoverHandler||this.defaultMouseoverHandler,this.mouseoutHandler=i.mouseoutHandler||this.defaultMouseoutHandler,this.backgroundColor=i.backgroundColor||"#666666",this.dataFormat=i.dataFormat?i.dataFormat.toLowerCase():"pointarray",this.clusterCssClass=e,this.map=d,this.pointIdProperty=i.pointIdProperty||null,this.tolerance=i.clusterTolerance||130,this.mapEdgeBuffer=i.mapEdgeBuffer||a.Utils.HypotenuseOfMapAsInt(d),this.layerVisibility="boolean"==typeof i.layerVisibility?i.layerVisibility:!0,this.reportingProperty=i.reportingProperty||null,this.reportingDictionary=i.reportingDictionary||{},this.defaultPalette=i.defaultPalette||["#8b722c","#e7dfc7","#040707","#c96228","#80adc0","#a19788","#ddecf2","#9e0000","#03671f","#8e2b5c","#e13066","#5c8276","#efa0cb","#62517b","#2c688b","#56c2a7","#e1df2f","#ed3333","#e69890","#545454"],this.mapOrder=i.mapOrder||null,this.reportingValueNA=i.reportingValueNA||{color:"#666666",label:"NA"},this.donutIRFrac=i.donutIRFrac||.4,this.activeCluster=null,j=b.length,this.pointData="geojson"===this.dataFormat?g(b):h(b),this.makeClusters(),this.map.on("moveend",this.mapMove,this),this.map.on("zoomstart",this.removeIndicatorPoints,this),this},a.PointClusterer.prototype.makeClusters=function(d,e,g,h){var i,j,k,l,m,n,o,p,q,h,r,s,t,u;if(clusterMarkers=[],lats=[],lngs=[],$(this.map._container).is(":visible")){for("undefined"!=typeof this.layer&&this.map.removeLayer(this.layer),h=this.map.getBounds(),r=c(this.map,h),s=b(h,r,this.mapEdgeBuffer),i=a.clusterPoints(this.pointData,s,r,this.tolerance),j={},t=i.length,u=t-1;u>=0;u--){j["cId_"+i[u].id]=i[u],o=i[u].points,k=o.length,l=this.backgroundColor?'<div style="background-color: '+this.backgroundColor+';"><span>'+k+"</span></div>":"<div><span>"+k+"</span></div>",m="leaflet-marker-icon q-marker-cluster "+this.clusterCssClass,1===k?(l='<div><div class="q-marker-single-default"><span>'+k+"</span></div></div></div>",m+=" q-marker-cluster-single",null!==this.reportingProperty&&o[0][this.reportingProperty]&&(q=o[0][this.reportingProperty].toString().split(","),"undefined"!=typeof this.reportingDictionary[q[0]]&&(l='<div style="background-color: '+this.reportingDictionary[q[0]].color+'"><div class="q-marker-single-default"><span>'+k+"</span></div></div></div>"))):m=100>k?m+" q-marker-cluster-small cId_"+i[u].id:1e3>k?m+" q-marker-cluster-medium cId_"+i[u].id:m+" q-marker-cluster-large cId_"+i[u].id,n=L.divIcon({className:m,html:l});var v=f(i[u].cY,i[u].cX);if(p=L.marker([v[1],v[0]],{icon:n}),p.points=o,p.pointIds=[],this.pointIdProperty)for(var w=o.length-1;w>=0;w--)p.pointIds.push(o[w][this.pointIdProperty]);p.stacked=!0,lats[0]=Math.round(1e4*o[0].lat)/1e4,lngs[0]=Math.round(1e4*o[0].lng)/1e4;for(var x=o.length-1;x>=0;x--)if(lats[x]=Math.round(1e4*o[x].lat)/1e4,lngs[x]=Math.round(1e4*o[x].lng)/1e4,lats[x]!==lats[0]||lngs[x]!==lngs[0]){p.stacked=!1;break}if(this.clickHandler&&(this.clickHandler&&p.on("click",this.clickHandler,this),this.mouseoverHandler&&p.on("mouseover",this.mouseoverHandler,this),this.mouseoutHandler&&p.on("mouseout",this.mouseoutHandler,this),this.idProperty)){p.pointIds=[];for(var w=0,y=k;y>w;w++)p.pointIds.push(o[w][this.idProperty])}clusterMarkers.push(p)}this.clusters=j,this.layer=L.featureGroup(clusterMarkers),this.map.addLayer(this.layer),this.layerVisibility&&(this.map.addLayer(this.layer),"number"==typeof this.mapOrder&&$("."+this.layerId).css("z-index",this.mapOrder),this.reportingProperty&&this.makeDonuts()),this.activeCluster&&this.markActiveCluster()}},a.PointClusterer.prototype.mapMove=function(){$(this.map._container).is(":visible")&&(this.map.removeLayer(this.layer),this.makeClusters())},a.PointClusterer.prototype.markActiveCluster=function(){if(null!==this.activeCluster)for(var a in this.layer._layers){var b=this.layer._layers[a]._latlng;b.lat===this.activeCluster._latlng.lat&&b.lng===this.activeCluster._latlng.lng&&$(this.layer._layers[a]._icon).toggleClass("active-marker",!0)}},a.PointClusterer.prototype.removeActiveCluster=function(){this.activeCluster=null,$(".leaflet-marker-pane .active-marker").toggleClass("active-marker",!1)},a.PointClusterer.prototype.removeLayer=function(){this.map.off("moveend",this.mapMove,this),this.map.off("click",this.removeActiveCluster,this),this.map.removeLayer(this.layer)},a.PointClusterer.prototype.replaceLayer=function(){this.map.on("moveend",this.mapMove,this),this.map.on("click",function(){this.removeActiveCluster(!0)},this),this.makeClusters()},a.PointClusterer.prototype.defaultClickHandler=function(b){var d,e,f,g,h,i;d=this,d.removeActiveCluster(),e=b.target,g=e.points,i=this.map.getMaxZoom(),f=this.map.getZoom(),h=c(this.map,this.map.getBounds());for(var j=f+1;i>j&&!a.moreThanOneCluster(g,h/this.map.getZoomScale(j),this.tolerance);j++);this.map.setView(e._latlng,j)},a.PointClusterer.prototype.defaultMouseoverHandler=function(a){if(!this.mouseoverGroup){this.mouseoverCluster=a.target;var b=this.mouseoverCluster.points,c=b.length;this.mouseoverGroup=L.layerGroup();for(var d=c-1;d>=0;--d){var e=b[d];if(this.reportingProperty&&e[this.reportingProperty])var f=e[this.reportingProperty],g=this.reportingDictionary[f].color;else var g=this.backgroundColor;var h=L.latLng([e.lat,e.lng]),i=new L.CircleMarker(h,{radius:3,color:g,fillOpacity:.3,opacity:0});this.mouseoverGroup.addLayer(i)}this.mouseoverGroup.addTo(this.map)}},a.PointClusterer.prototype.removeIndicatorPoints=function(){this.mouseoverCluster=null,this.map&&this.map.removeLayer&&this.mouseoverGroup&&this.map.removeLayer(this.mouseoverGroup),delete this.mouseoverGroup},a.PointClusterer.prototype.defaultMouseoutHandler=function(){this.removeIndicatorPoints()},a}(QCluster||{}),QCluster=function(a){return a.PointClusterer.prototype.makeDonuts=function(){var a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p=0;o=this.clusters;for(var q in o){b={},a=this.clusters[q].points;for(var r=a.length-1;r>=0;r--){m=a[r][this.reportingProperty].toString().split(",");for(var s=m.length-1,t=s;t>=0;t--)n=m[t],b.hasOwnProperty(n)?b[n].count++:""===n?b.hasOwnProperty("-9999")?b[-9999].count++:b[-9999]={count:1,color:this.reportingValueNA.color,alias:this.reportingValueNA.label}:("undefined"==typeof this.reportingDictionary[n]&&(p===this.defaultPalette.length&&(p=0),this.reportingDictionary[n]={color:this.defaultPalette[p],label:n},p+=1),b[n]={count:1,color:this.reportingDictionary[n].color,label:this.reportingDictionary[n].label})}c=[],d=[];for(var r in b)c.push(b[r]);for(var u={count:0,color:this.reportingValueNA.color,label:this.reportingValueNA.label},t=0,s=c.length;s>t;t++)c[t].label===this.reportingValueNA.label?u.count=u.count+c[t].count:d.push(c[t]);d.push(u),h=$("."+this.clusterCssClass+"."+q),e=$(h).width(),f=$(h).height(),g=Math.min(e,f)/2,i=d3.layout.pie().sort(null),j=d3.svg.arc().innerRadius(g-g*this.donutIRFrac).outerRadius(g),k=d3.select("."+this.clusterCssClass+"."+q).append("svg").attr("class","clusterDonut").attr("width",e).attr("height",f).append("g").attr("transform","translate("+e/2+","+f/2+")"),l=k.selectAll("path").data(function(){var a,b,c;a=d,b=[];for(var e=0,f=a.length;f>e;e++)b.push(a[e].count);c=i(b);for(var e=0,f=c.length;f>e;e++)c[e].data=a[e];return c}).enter().append("path").attr("fill",function(a){return a.data.color}).attr("d",j)}},a}(QCluster||{}),QCluster=function(a){return a.Utils=function(a){return a.FacetColorLibrary=function(a,b,c,d,e){var f,g,h,i,j,k;return f=e||{},h=f.colorPalette||["#8b722c","#e7dfc7","#040707","#c96228","#80adc0","#a19788","#ddecf2","#9e0000","#03671f","#8e2b5c","#e13066","#5c8276","#efa0cb","#62517b","#2c688b","#56c2a7","#e1df2f","#ed3333","#e69890","#545454"],i=f.maxColors||50,j=f.otherColor||"#666666",k={id:a,name:b,values_keyVal:{},values_arr:[],otherColor:j},_.each(c,function(a,b){var c={id:a[d.id],name:a[d.name],color:a[d.color]};("undefined"==typeof c.color||null===c.color)&&(b>i-1?c.color=j:b>h.length-1?(g=b%h.length-1,c.color=h[g]):c.color=h[b]),k.values_keyVal[c.id]=c,k.values_arr.push(c)}),k},a.HypotenuseOfMapAsInt=function(a){var b=$(a.getContainer()),c=b.width(),d=b.height();return Math.floor(Math.sqrt(c*c+d*d))},a}(a.Utils||{}),a}(QCluster||{});
//# sourceMappingURL=q-cluster.map.js